# üöÄ Automated CloudStack & Linstor Network Topology

This repository contains automation scripts to standardize the network configuration of KVM hosts running Apache CloudStack and Linstor SDS. It enforces a high-performance, segmented network topology with safety rollback mechanisms.

## üó∫Ô∏è Network Topology

We utilize a split-traffic architecture to isolate Storage I/O from Management and VM traffic.

### 1. Storage Network (`bond0`)
* **Physical:** Dedicated Bond (`bond0`).
* **Switch Configuration:** Access Port (Untagged VLAN 40).
* **Host Configuration:** Untagged Bridge (`cloudbr0`).
* **MTU:** **9000 (Jumbo Frames)** for maximum Linstor/DRBD performance.
* **Topology:** `Physical Interface` -> `bond0` -> `cloudbr0` (IP Here).

### 2. Management & Public Network (`bond1`)
* **Physical:** Shared Trunk Bond (`bond1`).
* **Switch Configuration:** Trunk Port (Tagged VLANs 41, 100, Guest VLANs).
* **MTU:** **1500** (Standard).
* **Sub-Networks:**
    * **Management:** VLAN 41 -> `bond1.41` -> `cloudbr1` (Host IP Here).
    * **Public:** VLAN 100 -> `bond1.100` -> `cloudbr100` (No Host IP, used by System VMs).
    * **Guest:** Raw Trunk (`bond1`) passed to CloudStack for dynamic VLAN creation.

## üìÇ Repository Contents

| File | Description |
| :--- | :--- |
| `01_discover.sh` | Interactive script. Scans the host, asks for bond mappings, and generates `server.conf`. |
| `02_deploy.sh` | The main executor. Reads `server.conf`, configures `nmcli`, updates Agent settings, and performs connectivity tests with rollback. |
| `server.conf` | Configuration file generated by the discovery script. Contains IP/Port details specific to the host. |

## üõ†Ô∏è Usage Guide

**WARNING:** These scripts modify network interfaces. SSH connectivity will be interrupted during execution. Always use `nohup`.

### Step 1: Discovery
Run the discovery script on the target host to generate the configuration.

```bash
chmod +x 01_discover.sh
./01_discover.sh
